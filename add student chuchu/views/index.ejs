<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student List</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-light">
    <nav class="navbar navbar-dark bg-primary p-3">
      <a href="/students" class="navbar-brand">Student Manager</a>
      <a href="/students/new" class="btn btn-warning">Add Student</a>
    </nav>

    <div class="container mt-4">
      <h2>Student List</h2>

      <!-- Search -->
      <form class="row g-3 mb-3" method="GET">
        <div class="col-md-4">
          <input
            type="text"
            name="search"
            placeholder="Search by name or course"
            class="form-control"
            value="<%= search %>"
          />
        </div>
        <div class="col-md-2">
          <button class="btn btn-primary">Search</button>
        </div>
      </form>

      <!-- Sorting -->
      <div class="mb-3">
        <a
          href="?search=<%= search %>&sort=name&order=asc"
          class="btn btn-sm btn-outline-primary"
          >Name ↑</a
        >
        <a
          href="?search=<%= search %>&sort=name&order=desc"
          class="btn btn-sm btn-outline-primary"
          >Name ↓</a
        >
        <a
          href="?search=<%= search %>&sort=course&order=asc"
          class="btn btn-sm btn-outline-secondary"
          >Course ↑</a
        >
        <a
          href="?search=<%= search %>&sort=course&order=desc"
          class="btn btn-sm btn-outline-secondary"
          >Course ↓</a
        >
      </div>

      <!-- Table -->
      <table class="table table-striped table-bordered">
        <thead class="table-dark">
          <tr>
            <th>Name</th>
            <th>Age</th>
            <th>Course</th>
            <th>Email</th>
            <th class="text-center">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% students.forEach(student => { %>
          <tr>
            <td><%= student.name %></td>
            <td><%= student.age %></td>
            <td><%= student.course %></td>
            <td><%= student.email %></td>
            <td class="text-center">
              <a
                href="/students/<%= student._id %>"
                class="btn btn-sm btn-info text-white"
                >View</a
              >
              <a
                href="/students/<%= student._id %>/edit"
                class="btn btn-sm btn-warning"
                >Edit</a
              >
              <form
                action="/students/<%= student._id %>/delete"
                method="POST"
                style="display: inline-block"
              >
                <button
                  class="btn btn-sm btn-danger"
                  onclick="return confirm('Delete this student?')"
                >
                  Delete
                </button>
              </form>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>

      <!-- Pagination -->
      <nav>
        <ul class="pagination">
          <% for(let p = 1; p <= totalPages; p++) { %>
          <li class="page-item <%= p === currentPage ? 'active' : '' %>">
            <a
              class="page-link"
              href="?page=<%= p %>&search=<%= search %>&sort=<%= sortField %>&order=<%= sortOrder === 1 ? 'asc' : 'desc' %>"
            >
              <%= p %>
            </a>
          </li>
          <% } %>
        </ul>
      </nav>
    </div>
  </body>
</html>
